날짜 범위 검증 함수의 명세를 검토하겠습니다. 먼저 현재 명세를 분석하여 개선점을 파악하겠습니다.

## 검증 결과

### 명확성
- **평가: 개선 필요**
- **의견:**
  - ISO 8601 문자열의 정확한 형식이 명시되지 않음 (타임존 포함 여부, 날짜만 vs 날짜+시간)
  - "이전", "이후"의 기준이 시간까지 고려하는지 날짜만 고려하는지 불명확
  - "경고 메시지"의 형태와 반환 방식이 명시되지 않음
  - 에러 메시지의 구체적인 내용이 정의되지 않음

### 완전성
- **평가: 개선 필요**
- **의견:**
  - **누락된 시나리오:**
    - 타임존이 다른 날짜 입력 처리
    - 유효하지 않은 Date 객체 (Invalid Date) 처리
    - 빈 문자열 입력 처리
    - 숫자(timestamp) 입력 처리 여부
    - 미래 날짜 vs 과거 날짜 제한 여부
  - **누락된 엣지 케이스:**
    - 윤년 경계 날짜
    - 일광절약시간(DST) 전환 날짜
    - Date 객체의 최소/최대 범위 (1970년 이전, 9999년 이후)
  - 100년 경고의 정확한 임계값 (100년 포함? 초과?)이 불명확

### 테스트 가능성
- **평가: 개선 필요**
- **의견:**
  - 에러 메시지의 정확한 문구가 명시되지 않아 테스트 작성 시 일관성 확보 어려움
  - "경고 메시지"의 테스트 방법이 불명확 (반환값에 포함? 콘솔 출력?)
  - 날짜 비교 시 시간 부분의 처리 방식이 명시되지 않음
  - 성공/실패 케이스의 예시가 부족함

### 일관성
- **평가: 개선 필요**
- **의견:**
  - **충돌 사항:**
    - 요구사항 3에서 유효한 경우 `{ isValid: true }`만 반환하지만, 요구사항 5의 100년 경고는 어떻게 전달되는지 불명확
    - "같은 날짜"가 시간까지 같아야 하는지, 날짜만 같으면 되는지 불명확
  - 입력 타입이 2가지(Date, string)인데 내부적으로 어떻게 정규화하는지 명시 필요

---

## 개선된 명세

# 날짜 범위 검증 함수 명세 v2.0

## 1. 기능 개요
두 날짜 사이의 기간이 유효한지 검증하는 함수입니다. 시작일이 종료일보다 이전이거나 같으면 유효한 것으로 판단합니다.

## 2. 함수 시그니처
```typescript
function validateDateRange(
  startDate: Date | string,
  endDate: Date | string
): ValidationResult

interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
}
```

## 3. 입력 명세

### 3.1 허용 타입
- **Date 객체**: JavaScript Date 인스턴스
- **ISO 8601 문자열**: 다음 형식을 지원
  - `YYYY-MM-DD` (예: "2024-01-15")
  - `YYYY-MM-DDTHH:mm:ss.sssZ` (예: "2024-01-15T09:30:00.000Z")
  - `YYYY-MM-DDTHH:mm:ss.sss±HH:mm` (예: "2024-01-15T09:30:00.000+09:00")

### 3.2 입력 전처리
- 문자열 입력 시 `new Date()` 생성자로 변환
- 날짜 비교는 **일(day) 단위**로 수행 (시간은 무시)
  - 내부적으로 `startDate.setHours(0,0,0,0)` 처리
- 타임존은 시스템 로컬 타임존을 기준으로 처리

## 4. 검증 규칙

### 4.1 유효성 조건
다음 조건을 **모두** 만족해야 유효:
1. startDate와 endDate가 모두 유효한 날짜
2. startDate(일 기준) ≤ endDate(일 기준)

### 4.2 비교 로직
- 시간 부분을 제거한 날짜만 비교
- 예시:
  - `2024-01-15 23:59:59` vs `2024-01-16 00:00:01` → 유효 (1일 차이)
  - `2024-01-15 00:00:00` vs `2024-01-15 23:59:59` → 유효 (같은 날)

## 5. 출력 명세

### 5.1 성공 케이스
```typescript
// 일반적인 유효 범위
{ isValid: true }

// 100년 이상 범위 (경고 포함)
{ 
  isValid: true, 
  warning: "Date range exceeds 100 years. Please verify the dates are correct." 
}
```

### 5.2 실패 케이스
```typescript
// 시작일 > 종료일
{ 
  isValid: false, 
  error: "Start date must be before or equal to end date" 
}

// null 입력
{ 
  isValid: false, 
  error: "Start date and end date are required" 
}

// 유효하지 않은 날짜
{ 
  isValid: false, 
  error: "Invalid date format provided" 
}
```

## 6. 에러 처리 상세

| 입력 케이스 | error 메시지 | 비고 |
|------------|--------------|------|
| startDate가 null/undefined | "Start date and end date are required" | |
| endDate가 null/undefined | "Start date and end date are required" | |
| 둘 다 null/undefined | "Start date and end date are required" | |
| 빈 문자열 ("") | "Invalid date format provided" | |
| 잘못된 형식 문자열 | "Invalid date format provided" | 예: "not-a-date" |
| Invalid Date 객체 | "Invalid date format provided" | `isNaN(date.getTime())` |
| startDate > endDate | "Start date must be before or equal to end date" | 일 기준 비교 |

## 7. 엣지 케이스

### 7.1 같은 날짜
- **케이스**: `2024-01-15 09:00` vs `2024-01-15 18:00`
- **결과**: `{ isValid: true }`
- **설명**: 시간이 다르더라도 날짜가 같으면 유효

### 7.2 1일 차이
- **케이스**: `2024-01-15` vs `2024-01-16`
- **결과**: `{ isValid: true }`

### 7.3 100년 이상 차이
- **케이스**: `1900-01-01` vs `2024-01-01` (124년)
- **결과**: 
  ```typescript
  { 
    isValid: true, 
    warning: "Date range exceeds 100 years. Please verify the dates are correct." 
  }
  ```
- **임계값**: 정확히 36,525일 초과 (100년 × 365.25일)

### 7.4 윤년 경계
- **케이스**: `2024-02-29` (유효한 윤년 날짜)
- **결과**: 정상 처리
- **케이스**: `2023-02-29` (무효한 날짜)
- **결과**: `{ isValid: false, error: "Invalid date format provided" }`

### 7.5 Date 범위 한계
- **케이스**: `1900-01-01` (JavaScript Date 최소값 근처)
- **결과**: 유효한 Date 객체면 정상 처리
- **케이스**: `9999-12-31` (먼 미래)
- **결과**: 유효한 Date 객체면 정상 처리 + 100년 경고 가능

### 7.6 타임존 차이
- **케이스**: `2024-01-15T23:00:00+09:00` vs `2024-01-15T15:00:00Z` (동일 시각)
- **결과**: `{ isValid: true }`
- **설명**: UTC 변환 후 날짜 비교

## 8. 테스트 케이스 요약

```typescript
// 1. 정상 케이스
validateDateRange('2024-01-01', '2024-12-31') 
// → { isValid: true }

// 2. 같은 날
validateDateRange('2024-01-15', '2024-01-15')
// → { isValid: true }

// 3. 역순
validateDateRange('2024-12-31', '2024-01-01')
// → { isValid: false, error: "Start date must be before or equal to end date" }

// 4. null 입력
validateDateRange(null, '2024-01-01')
// → { isValid: false, error: "Start date and end date are required" }

// 5. 잘못된 형식
validateDateRange('invalid', '2024-01-01')
// → { isValid: false, error: "Invalid date format provided" }

// 6. 100년 초과
validateDateRange('1900-01-01', '2024-01-01')
// → { isValid: true, warning: "Date range exceeds 100 years..." }

// 7. Date 객체 혼용
validateDateRange(new Date('2024-01-01'), '2024-12-31')
// → { isValid: true }

// 8. 시간 차이 무시
validateDateRange('2024-01-15T23:59:59', '2024-01-16T00:00:01')
// → { isValid: true }
```

## 9. 구현 참고사항

### 9.1 날짜 정규화 방법
```typescript
function normalizeDate(date: Date): Date {
  const normalized = new Date(date);
  normalized.setHours(0, 0, 0, 0);
  return normalized;
}
```

### 9.2 100년 계산
```typescript
const daysDiff = (endDate - startDate) / (1000 * 60 * 60 * 24);
const DAYS_IN_100_YEARS = 36525; // 100 × 365.25
if (daysDiff > DAYS_IN_100_YEARS) {
  return { isValid: true, warning: "..." };
}
```

## 10. 제외 사항
다음 기능은 **명시적으로 지원하지 않음**:
- 영업일 기준 계산
- 휴일/공휴일 고려
- 숫자(timestamp) 직접 입력
- Date 외 moment, dayjs 등 라이브러리 객체

---

이 개선된 명세는 모호성을 제거하고, 모든 엣지 케이스를 명시하며, 구체적인 에러 메시지와 테스트 케이스를 제공하여 TDD 개발이 가능하도록 작성되었습니다.
