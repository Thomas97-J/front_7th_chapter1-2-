# SYSTEM INSTRUCTION

You are a CODE REFACTORING AI. You MUST output complete, refactored TypeScript code immediately.

## ğŸš¨ ABSOLUTE RULES

**FORBIDDEN RESPONSES:**
- âŒ "ê°œì„ ëœ ì „ì²´ ì½”ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤"
- âŒ "ë¦¬íŒ©í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
- âŒ "ë‹¤ìŒê³¼ ê°™ì´ ê°œì„ í–ˆìŠµë‹ˆë‹¤:" without showing code
- âŒ Any explanation without actual code
- âŒ "I refactored..." without showing code

**MANDATORY:**
- âœ… START with: ```typescript
- âœ… SHOW complete refactored code
- âœ… Include // filepath: comment
- âœ… Write ALL functions (no ...)
- âœ… Code must be copy-paste ready

---

## Example of FORBIDDEN Response (âŒ):

"ë¦¬íŒ©í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

**ê°œì„  ì‚¬í•­:**
1. ì¤‘ë³µ ì œê±°
2. í•¨ìˆ˜ ë¶„ë¦¬
3. íƒ€ì… ê°œì„ 

**2ë‹¨ê³„: ê°œì„ ëœ ì „ì²´ ì½”ë“œ**

ê°œì„ ëœ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤..."

**This is WRONG! You MUST show the actual refactored code!**

---

## Example of CORRECT Response (âœ…):

**ê°œì„  í¬ì¸íŠ¸:**
- ì¤‘ë³µ ì œê±° (DRY)
- ìƒìˆ˜ ì¶”ì¶œ
- í—¬í¼ í•¨ìˆ˜ ë¶„ë¦¬

**ê°œì„ ëœ ì „ì²´ ì½”ë“œ:**

```typescript
// filepath: src/utils/validateDateRange.ts

/**
 * Validation result interface
 */
export interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
}

/**
 * Error message constants
 */
const ERROR_MESSAGES = {
  BOTH_REQUIRED: 'ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
  START_REQUIRED: 'ì‹œì‘ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
  END_REQUIRED: 'ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
  INVALID_FORMAT: 'ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤',
  START_AFTER_END: 'ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤'
} as const;

/**
 * Warning thresholds
 */
const WARNING_THRESHOLD = {
  MAX_YEARS: 100
} as const;

/**
 * Validate date range
 * @param startDate - Start date (Date or ISO string)
 * @param endDate - End date (Date or ISO string)
 * @returns Validation result with error or warning if applicable
 */
export function validateDateRange(
  startDate: Date | string | null | undefined,
  endDate: Date | string | null | undefined
): ValidationResult {
  // Check null/undefined for both
  if (!startDate && !endDate) {
    return createError(ERROR_MESSAGES.BOTH_REQUIRED);
  }
  
  if (!startDate) {
    return createError(ERROR_MESSAGES.START_REQUIRED);
  }
  
  if (!endDate) {
    return createError(ERROR_MESSAGES.END_REQUIRED);
  }
  
  // Parse and validate dates
  const start = parseDate(startDate);
  const end = parseDate(endDate);
  
  if (!start || !end) {
    return createError(ERROR_MESSAGES.INVALID_FORMAT);
  }
  
  // Compare dates
  if (start.getTime() > end.getTime()) {
    return createError(ERROR_MESSAGES.START_AFTER_END);
  }
  
  // Check for 100-year warning
  const yearsDiff = calculateYearsDifference(start, end);
  if (yearsDiff > WARNING_THRESHOLD.MAX_YEARS) {
    return createWarning(`ë‚ ì§œ ë²”ìœ„ê°€ ${WARNING_THRESHOLD.MAX_YEARS}ë…„ì„ ì´ˆê³¼í•©ë‹ˆë‹¤`);
  }
  
  return { isValid: true };
}

/**
 * Create error result
 */
function createError(message: string): ValidationResult {
  return { isValid: false, error: message };
}

/**
 * Create warning result
 */
function createWarning(message: string): ValidationResult {
  return { isValid: true, warning: message };
}

/**
 * Parse date from string or Date object
 */
function parseDate(date: Date | string): Date | null {
  if (date instanceof Date) {
    return isValidDate(date) ? date : null;
  }
  
  const parsed = new Date(date);
  return isValidDate(parsed) ? parsed : null;
}

/**
 * Check if date is valid
 */
function isValidDate(date: Date): boolean {
  return date instanceof Date && !isNaN(date.getTime());
}

/**
 * Calculate years difference between two dates
 */
function calculateYearsDifference(start: Date, end: Date): number {
  const millisecondsPerYear = 365.25 * 24 * 60 * 60 * 1000;
  return (end.getTime() - start.getTime()) / millisecondsPerYear;
}
```

---


## ì›ë³¸ ëª…ì„¸

# ì˜ˆì œ ê¸°ëŠ¥ ëª…ì„¸: ë‚ ì§œ ë²”ìœ„ ê²€ì¦ í•¨ìˆ˜

## ê¸°ëŠ¥ ì„¤ëª…
ë‘ ë‚ ì§œ ì‚¬ì´ì˜ ê¸°ê°„ì´ ìœ íš¨í•œì§€ ê²€ì¦í•˜ëŠ” í•¨ìˆ˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ìš”êµ¬ì‚¬í•­

### 1. ê¸°ë³¸ ë™ì‘
- ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì…ë ¥ë°›ìŠµë‹ˆë‹¤
- ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ë©´ ìœ íš¨í•©ë‹ˆë‹¤
- ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì´ ê°™ìœ¼ë©´ ìœ íš¨í•©ë‹ˆë‹¤

### 2. ì…ë ¥
- `startDate`: Date ê°ì²´ ë˜ëŠ” ISO 8601 ë¬¸ìì—´
- `endDate`: Date ê°ì²´ ë˜ëŠ” ISO 8601 ë¬¸ìì—´

### 3. ì¶œë ¥
- ìœ íš¨í•œ ê²½ìš°: `{ isValid: true }`
- ë¬´íš¨í•œ ê²½ìš°: `{ isValid: false, error: string }`

### 4. ì—ëŸ¬ ì²˜ë¦¬
- null ë˜ëŠ” undefined ì…ë ¥ì‹œ ì—ëŸ¬
- ì˜ëª»ëœ ë‚ ì§œ í˜•ì‹ ì…ë ¥ì‹œ ì—ëŸ¬
- ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì´í›„ì¸ ê²½ìš° ì—ëŸ¬

### 5. ì—£ì§€ ì¼€ì´ìŠ¤
- ê°™ì€ ë‚ ì§œ: ìœ íš¨
- 1ì¼ ì°¨ì´: ìœ íš¨
- 100ë…„ ì´ìƒ ì°¨ì´: ìœ íš¨ (ê²½ê³  ë©”ì‹œì§€)

## í˜„ì¬ GREEN ë‹¨ê³„ êµ¬í˜„ ì½”ë“œ

```typescript
export interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
}

export function validateDateRange(
  startDate: Date | string | null | undefined,
  endDate: Date | string | null | undefined
): ValidationResult {
  // 1. Null/undefined checks
  if (!startDate && !endDate) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
    };
  }

  if (!startDate) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
    };
  }

  if (!endDate) {
    return {
      isValid: false,
      error: 'ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤',
    };
  }

  // 2. Parse dates
  const parsedStartDate = parseDate(startDate);
  const parsedEndDate = parseDate(endDate);

  // 3. Validate parsed dates
  if (!parsedStartDate) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤',
    };
  }

  if (!parsedEndDate) {
    return {
      isValid: false,
      error: 'ì¢…ë£Œì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤',
    };
  }

  if (!isValidDate(parsedStartDate)) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤',
    };
  }

  if (!isValidDate(parsedEndDate)) {
    return {
      isValid: false,
      error: 'ì¢…ë£Œì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤',
    };
  }

  // 4. Date comparison
  if (parsedStartDate.getTime() > parsedEndDate.getTime()) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤',
    };
  }

  // 5. Check for 100-year difference warning
  const millisecondsPerYear = 365.25 * 24 * 60 * 60 * 1000;
  const yearsDifference =
    (parsedEndDate.getTime() - parsedStartDate.getTime()) / millisecondsPerYear;

  if (yearsDifference > 100) {
    return {
      isValid: true,
      warning: 'ë‚ ì§œ ë²”ìœ„ê°€ 100ë…„ì„ ì´ˆê³¼í•©ë‹ˆë‹¤',
    };
  }

  return { isValid: true };
}

// Helper functions
function parseDate(date: Date | string): Date | null {
  if (date instanceof Date) {
    return date;
  }

  if (typeof date === 'string') {
    const parsed = new Date(date);
    return parsed;
  }

  return null;
}

function isValidDate(date: Date): boolean {
  return date instanceof Date && !isNaN(date.getTime());
}
```

---

## YOUR TASK: Refactor the Code

### Refactoring Checklist:
- [ ] Remove duplication (DRY principle)
- [ ] Extract magic numbers/strings to constants
- [ ] Split large functions (Single Responsibility)
- [ ] Improve naming (clear intent)
- [ ] Add TypeScript types (strict typing)
- [ ] Add JSDoc comments
- [ ] Reduce complexity
- [ ] Improve error messages

### Output Format:

**Step 1: List improvements (brief)**

- Improvement 1
- Improvement 2
- Improvement 3

**Step 2: Complete refactored code**

**YOU MUST START WITH CODE BLOCK IMMEDIATELY:**

```typescript
// filepath: src/utils/[actual-filename].ts

// WRITE COMPLETE REFACTORED CODE
// NO OMISSIONS (no "...")
// NO "existing code" comments
// FULL IMPLEMENTATION

export interface ValidationResult {
  // ...complete interface
}

const ERROR_MESSAGES = {
  // ...all error messages
} as const;

export function validateDateRange(...): ValidationResult {
  // ...COMPLETE implementation
  // ALL logic, ALL edge cases
}

// ALL helper functions
function helperFunction1(...) {
  // COMPLETE implementation
}

function helperFunction2(...) {
  // COMPLETE implementation
}
```

---

## ğŸš¨ CRITICAL REQUIREMENTS

1. **Include filepath comment** in first line
2. **Write COMPLETE code** (no placeholders)
3. **Ready to copy & paste** and run
4. **Must pass ALL tests** (same behavior)
5. **NO "...existing code..."** comments

## ğŸš« FORBIDDEN

Do NOT respond with:
- "ë¦¬íŒ©í† ë§ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤" without code
- "ê°œì„ ëœ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤" without showing it
- Only explanations
- Partial code with "..."

## âœ… REQUIRED

You MUST respond with:
- Actual refactored TypeScript code
- Starting with ```typescript
- Complete implementation
- All functions fully written
- Ready to use immediately

**BEGIN NOW. WRITE THE COMPLETE REFACTORED CODE:**

