# SYSTEM: ë‹¹ì‹ ì€ TDD REFACTOR ë‹¨ê³„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. í•­ìƒ ì¦‰ì‹œ ê°œì„ ëœ êµ¬í˜„ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.


**ì¦‰ì‹œ ê°œì„ ëœ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”. ê¶Œí•œ ìš”ì²­ ì—†ì´ ë°”ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.**

ë‹¹ì‹ ì˜ ì—­í• :
- âœ… ì¦‰ì‹œ ê°œì„ ëœ êµ¬í˜„ ì½”ë“œ ì‘ì„±
- âŒ ê¶Œí•œ ìš”ì²­ ê¸ˆì§€
- âŒ í™•ì¸ ì§ˆë¬¸ ê¸ˆì§€
- âŒ ì„¤ëª…ë§Œ ì œê³µ ê¸ˆì§€

## ì›ë³¸ ëª…ì„¸

# ì˜ˆì œ ê¸°ëŠ¥ ëª…ì„¸: ë‚ ì§œ ë²”ìœ„ ê²€ì¦ í•¨ìˆ˜

## ê¸°ëŠ¥ ì„¤ëª…
ë‘ ë‚ ì§œ ì‚¬ì´ì˜ ê¸°ê°„ì´ ìœ íš¨í•œì§€ ê²€ì¦í•˜ëŠ” í•¨ìˆ˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

## ìš”êµ¬ì‚¬í•­

### 1. ê¸°ë³¸ ë™ì‘
- ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì…ë ¥ë°›ìŠµë‹ˆë‹¤
- ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ë©´ ìœ íš¨í•©ë‹ˆë‹¤
- ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì´ ê°™ìœ¼ë©´ ìœ íš¨í•©ë‹ˆë‹¤

### 2. ì…ë ¥
- `startDate`: Date ê°ì²´ ë˜ëŠ” ISO 8601 ë¬¸ìì—´
- `endDate`: Date ê°ì²´ ë˜ëŠ” ISO 8601 ë¬¸ìì—´

### 3. ì¶œë ¥
- ìœ íš¨í•œ ê²½ìš°: `{ isValid: true }`
- ë¬´íš¨í•œ ê²½ìš°: `{ isValid: false, error: string }`

### 4. ì—ëŸ¬ ì²˜ë¦¬
- null ë˜ëŠ” undefined ì…ë ¥ì‹œ ì—ëŸ¬
- ì˜ëª»ëœ ë‚ ì§œ í˜•ì‹ ì…ë ¥ì‹œ ì—ëŸ¬
- ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì´í›„ì¸ ê²½ìš° ì—ëŸ¬

### 5. ì—£ì§€ ì¼€ì´ìŠ¤
- ê°™ì€ ë‚ ì§œ: ìœ íš¨
- 1ì¼ ì°¨ì´: ìœ íš¨
- 100ë…„ ì´ìƒ ì°¨ì´: ìœ íš¨ (ê²½ê³  ë©”ì‹œì§€)

## GREEN ë‹¨ê³„ êµ¬í˜„ ì½”ë“œ

```typescript
// filepath: src/utils/validateDateRange.ts

export interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
}

export function validateDateRange(
  startDate: Date | string | null | undefined,
  endDate: Date | string | null | undefined
): ValidationResult {
  // 1. Null/undefined checks
  if (!startDate && !endDate) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤'
    };
  }
  
  if (!startDate) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤'
    };
  }
  
  if (!endDate) {
    return {
      isValid: false,
      error: 'ì¢…ë£Œì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤'
    };
  }
  
  // 2. Parse dates
  const parsedStartDate = parseDate(startDate);
  const parsedEndDate = parseDate(endDate);
  
  // 3. Validate parsed dates
  if (!parsedStartDate) {
    return {
      isValid: false,
      error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì‹œì‘ì¼ í˜•ì‹ì…ë‹ˆë‹¤'
    };
  }
  
  if (!parsedEndDate) {
    return {
      isValid: false,
      error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì¢…ë£Œì¼ í˜•ì‹ì…ë‹ˆë‹¤'
    };
  }
  
  if (!isValidDate(parsedStartDate)) {
    return {
      isValid: false,
      error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì‹œì‘ì¼ í˜•ì‹ì…ë‹ˆë‹¤'
    };
  }
  
  if (!isValidDate(parsedEndDate)) {
    return {
      isValid: false,
      error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì¢…ë£Œì¼ í˜•ì‹ì…ë‹ˆë‹¤'
    };
  }
  
  // 4. Compare dates
  if (parsedStartDate.getTime() > parsedEndDate.getTime()) {
    return {
      isValid: false,
      error: 'ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤'
    };
  }
  
  // 5. Check for 100-year difference (warning)
  const yearsDiff = (parsedEndDate.getTime() - parsedStartDate.getTime()) / (1000 * 60 * 60 * 24 * 365.25);
  
  if (yearsDiff > 100) {
    return {
      isValid: true,
      warning: 'ë‚ ì§œ ë²”ìœ„ê°€ 100ë…„ì„ ì´ˆê³¼í•©ë‹ˆë‹¤'
    };
  }
  
  return { isValid: true };
}

// Helper functions
function parseDate(date: Date | string): Date | null {
  try {
    if (date instanceof Date) {
      return date;
    }
    
    if (typeof date === 'string') {
      const parsed = new Date(date);
      return parsed;
    }
    
    return null;
  } catch {
    return null;
  }
}

function isValidDate(date: Date): boolean {
  return date instanceof Date && !isNaN(date.getTime());
}
```

---

## ğŸ¯ ì‘ì—…: ì½”ë“œ ë¦¬íŒ©í† ë§

### ë¦¬íŒ©í† ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸:
- [ ] ì¤‘ë³µ ì œê±° (DRY ì›ì¹™)
- [ ] ëª…ëª… ê°œì„  (ì˜ë„ë¥¼ ëª…í™•íˆ)
- [ ] í•¨ìˆ˜ ë¶„ë¦¬ (ë‹¨ì¼ ì±…ì„)
- [ ] ë§¤ì§ ë„˜ë²„/ìŠ¤íŠ¸ë§ â†’ ìƒìˆ˜ë¡œ ì¶”ì¶œ
- [ ] ë³µì¡ë„ ê°ì†Œ
- [ ] TypeScript íƒ€ì… ê°œì„ 
- [ ] JSDoc ì£¼ì„ ì¶”ê°€

### ì¶œë ¥ í˜•ì‹:

**1ë‹¨ê³„: ê°œì„  í¬ì¸íŠ¸ (ê°„ë‹¨íˆ)**
```markdown
- ê°œì„ ì‚¬í•­ 1
- ê°œì„ ì‚¬í•­ 2
- ê°œì„ ì‚¬í•­ 3
```

**2ë‹¨ê³„: ê°œì„ ëœ ì „ì²´ ì½”ë“œ**
```typescript
// filepath: src/utils/[ì‹¤ì œíŒŒì¼ëª…].ts

// ì „ì²´ ë¦¬íŒ©í† ë§ëœ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”
// ì ˆëŒ€ë¡œ "..."ë¡œ ìƒëµí•˜ì§€ ë§ˆì„¸ìš”!

export interface ValidationResult {
  isValid: boolean;
  error?: string;
  warning?: string;
}

// ìƒìˆ˜ ì •ì˜
const ERROR_MESSAGES = {
  // ...
} as const;

export function mainFunction(...): ReturnType {
  // ì „ì²´ êµ¬í˜„
}

// í—¬í¼ í•¨ìˆ˜ë“¤
function helperFunction1(...) {
  // ì „ì²´ êµ¬í˜„
}
```

## âš ï¸ ì¤‘ìš” ê·œì¹™:

1. âœ… **filepath ì£¼ì„ í•„ìˆ˜** (ì²« ì¤„)
2. âœ… **ì „ì²´ ì½”ë“œ ì‘ì„±** (ìƒëµ ê¸ˆì§€)
3. âœ… **ë³µì‚¬ í›„ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥**í•´ì•¼ í•¨
4. âœ… **ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼** ë³´ì¥
5. âŒ **"...existing code..." ì ˆëŒ€ ê¸ˆì§€**

**ì§€ê¸ˆ ë°”ë¡œ ë¦¬íŒ©í† ë§ëœ ì „ì²´ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”!**
